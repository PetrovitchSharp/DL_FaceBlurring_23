# DL_FaceBlurring_23
Бот для замыливания лиц на фотографии


# Задача детекции лиц

### <p>Мы использовали модели из пакета [Detectron2](https://huggingface.co/datasets/wider_face/tree/main) и дообучали их на датасете [Wider Face](https://huggingface.co/datasets/wider_face/tree/main).</p><br>

<p> Мы выбрали Detectron2 для этого проекта, так как это популярная библиотека, разработанная компанией facebook, и в ней доступно множество моделей, из которых можно выбрать наиболее подходящую в зависимости от того, что будет необходимо оптимизировать в проекте - качество или скорость.<p>

## Результаты экспериментов с 3 моделями:


| Model |   AP   |  AP50  |  AP75  |  APs   |  APm   |  APl   |
| --- | --- | --- | --- | --- | --- | --- |
| faster_rcnn_R_50_FPN | 29.808 | 56.563 | 28.486 | 18.259 | 55.719 | 65.323 |
| faster_rcnn_R_101_FPN | 30.116 | 56.954 | 28.821 | 18.188 | 56.415 | 66.945 |
| retinanet_R_101_FPN | 30.106 | 54.910 | 30.166 | 16.891 | 59.845 | 69.292 |

<p>Чуть лучшее качество имеет модель faster_rcnn_R_101_FPN, поэтому далее будем использовать именно ее.</p><br>

# Установка зависимостей

<p> Все зависимости находятся в файле requirements.txt

# Запуск обучения модели

1. Скачайте датасет [Wider Face](https://huggingface.co/datasets/wider_face/tree/main). Разархивируйте файлы **WIDER_train.zip**, **WIDER_val.zip** и **wider_face_split.zip** в папку **data**.
1. Запустите скрипт src/convert_dataset.py для конвертации датасета в формат COCO (сохранение json файла):

        python src/convert_dataset.py
1. Запустите скрипт для обучения модели (конфиги лежат в папке configs), можно указать конкретный config через параметр **--config**. По-умолчанию используется модель **faster_rcnn_R_101_FPN**:

        python src/train_detection_model.py

# Запуск примера инференса
1. Запуск инференса для примера из example/example.jpg. Результат будет сохранен в файл example/blurred_example.jpg

        python src/sample_inference.py

# Скорость инференса на RTX 3090

| Model |   sec / image   |
| --- | --- |
| faster_rcnn_R_50_FPN | 0.027309 |
| faster_rcnn_R_101_FPN | 0.035943  |
| retinanet_R_101_FPN | 0.035934 |

Один GPU может в секунду обработать около 28 изображений в секунду. Можно обучить более легкую модель, если будет необходимо масштабировать решение.
